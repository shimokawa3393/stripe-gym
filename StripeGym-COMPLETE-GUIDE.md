# StripeGymå®Œå…¨çµ±åˆã‚¬ã‚¤ãƒ‰ ğŸ‹ï¸â€â™‚ï¸

> **StripeGymã®å…¨å­¦ç¿’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’çµ±åˆï¼Day0-Day15ã®å…¨ã¦ + è©³ç´°å®Ÿè£…æ‰‹é † + ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆ + æœ¬ç•ªé‹ç”¨ã¾ã§**

## ğŸ“‹ ç›®æ¬¡

1. [ğŸ“– æ¦‚è¦ã¨ç›®æ¨™](#-æ¦‚è¦ã¨ç›®æ¨™)
2. [ğŸ—ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ](#ï¸-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ)
3. [ğŸ“ åŸºæœ¬ç·¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰ (Day0-Day6)](#-åŸºæœ¬ç·¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰-day0-day6)
4. [ğŸš€ å¿œç”¨ç·¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰ (Day7-Day15)](#-å¿œç”¨ç·¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰-day7-day15)
5. [ğŸŒ æœ¬ç•ªé‹ç”¨ã¨ç®¡ç†](#-æœ¬ç•ªé‹ç”¨ã¨ç®¡ç†)
6. [ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#-ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
7. [ğŸ“ˆ æ¬¡ã¸ã®ç™ºå±•ã¨ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°](#-æ¬¡ã¸ã®ç™ºå±•ã¨ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°)

> âš¡ **ã“ã®ã‚¬ã‚¤ãƒ‰ä¸€ã¤ã§å…¨å­¦ç¿’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å®Œäº†ï¼å€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦ï¼**

---

## ğŸ“– æ¦‚è¦ã¨ç›®æ¨™

### StripeGymã¨ã¯ï¼Ÿ

**ğŸ¯ ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ StripeGym ã®å…¨å­¦ç¿’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’çµ±åˆã—ãŸä¸€æœ¬åŒ–ã‚¬ã‚¤ãƒ‰ã§ã™ï¼**

StripeGymã¯ã€**Stripeæ±ºæ¸ˆã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ã£ãŸãƒªã‚¢ãƒ«ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ã®æ§‹ç¯‰ã‚’é€šã˜ã¦ã€ä»¥ä¸‹ã®ã‚¹ã‚­ãƒ«ã‚’ç¿’å¾—ã™ã‚‹ãŸã‚ã®å­¦ç¿’ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã§ã™ï¼š

- âœ… **Python Flaskã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™º**
- âœ… **Dockerã‚’ä½¿ã£ãŸãƒ¢ãƒ€ãƒ³ãªé–‹ç™ºç’°å¢ƒ**
- âœ… **Stripeæ±ºæ¸ˆAPIçµ±åˆ**
- âœ… **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆãƒ»ç®¡ç†**
- âœ… **Webhookã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†**
- âœ… **ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ï¼ˆpytestï¼‰**
- âœ… **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰**
- âœ… **æœ¬ç•ªé‹ç”¨ãƒ»ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ **

### ğŸ¯ æœ€çµ‚çš„ãªæˆæœç‰©

ã“ã®ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã‚’å®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®**æœ¬ç•ªé‹ç”¨å¯èƒ½ãªæ±ºæ¸ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ãŒå®Œæˆã—ã¾ã™ï¼š

```bash
ğŸŒŸ Stripe Checkout ã«ã‚ˆã‚‹æ±ºæ¸ˆå‡¦ç†
ğŸŒŸ Stripe Customer Portal ã«ã‚ˆã‚‹é¡§å®¢ç®¡ç†
ğŸŒŸ PostgreSQL ã«ã‚ˆã‚‹ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³è¨˜éŒ²
ğŸŒŸ Webhook ã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ
ğŸŒŸ åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆï¼ˆ96%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
ğŸŒŸ CI/CDè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚·ã‚¹ãƒ†ãƒ 
ğŸŒŸ ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºç´šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
ğŸŒŸ ç›£è¦–ãƒ»é€šçŸ¥ãƒ»ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ 
```

---

## ğŸ—ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
stripe-gym/
â”œâ”€â”€ ğŸ“ backend/                    # Flaskã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ ğŸ“„ app.py                  # åŸºæœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆé–‹ç™ºç”¨ï¼‰
â”‚   â”œâ”€â”€ ğŸ“„ app_production.py       # æœ¬ç•ªç”¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ ğŸ“„ security.py             # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½
â”‚   â”œâ”€â”€ ğŸ“„ monitoring.py           # ç›£è¦–ãƒ»ãƒ­ã‚°ãƒ»é€šçŸ¥æ©Ÿèƒ½
â”‚   â”œâ”€â”€ ğŸ“„ cache.py               # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
â”‚   â”œâ”€â”€ ğŸ“ routes/                 # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ auth_routes.py         # èªè¨¼
â”‚   â”‚   â”œâ”€â”€ user_routes.py         # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ payment_routes.py      # æ±ºæ¸ˆå‡¦ç†
â”‚   â”‚   â”œâ”€â”€ webhook_routes.py     # Webhookå‡¦ç†
â”‚   â”‚   â””â”€â”€ billing_portal_routes.py # Customer Portal
â”‚   â”œâ”€â”€ ğŸ“ repositories/           # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
â”‚   â”œâ”€â”€ ğŸ“ models/                # SQLAlchemyãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ ğŸ“ tests/                 # ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
â”‚   â”‚   â”œâ”€â”€ test_integration.py   # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ test_webhook.py       # Webhookãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ test_performance.py   # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â””â”€â”€ run_tests.sh          # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â””â”€â”€ ğŸ“ alembic/              # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ ğŸ“ frontend/                  # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ ğŸ“ views/                 # HTMLãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ ğŸ“ js/                    # JavaScript
â”‚   â””â”€â”€ ğŸ“ styles/                # CSS
â”œâ”€â”€ ğŸ“ .github/workflows/         # CI/CDè¨­å®š
â”‚   â”œâ”€â”€ test.yml                  # ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–
â”‚   â””â”€â”€ deploy.yml                # ãƒ‡ãƒ—ãƒ­ã‚¤è‡ªå‹•åŒ–
â”œâ”€â”€ ğŸ“„ docker-compose.yml         # Dockerç’°å¢ƒ
â”œâ”€â”€ ğŸ“„ env.production.example     # æœ¬ç•ªç’°å¢ƒè¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â””â”€â”€ ğŸ“„ DEPLOYMENT.md              # ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¬ã‚¤ãƒ‰
```

### æ¡ç”¨æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

#### Backend
```bash
ğŸ Python 3.11
âš¡ Flask 3.1.2 - Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
ğŸ—„ï¸ SQLAlchemy 2.0.43 - ORM
ğŸ—„ï¸ PostgreSQL 13+ - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
ğŸ”§ Alembic 1.16.5 - ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
ğŸ’° Stripe 12.4.0 - æ±ºæ¸ˆAPI
ğŸ”´ Redis 5.0.1 - ã‚­ãƒ£ãƒƒã‚·ãƒ¥
```

#### Frontend
```bash
ğŸ¨ HTML5/CSS3/JavaScript
ğŸ’³ Stripe.js - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ±ºæ¸ˆ
ğŸŒ Nginx - ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·
```

#### DevOps
```bash
ğŸ³ Docker & Docker Compose
ğŸ”„ GitHub Actions - CI/CD
ğŸ“‹ pytest - ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–
ğŸ“Š Monitoring & Logging
ğŸ”’ Security Headers & Rate Limiting
```

---

## ğŸ“ åŸºæœ¬ç·¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰ (Day0-Day6)

> **åˆå¿ƒè€…ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆï¼ã‚†ã£ãã‚Šæ®µéšçš„ã«å­¦ç¿’**

é–‹å§‹å‰ã®æº–å‚™ï¼š
- âœ… Dockerã®åŸºæœ¬çŸ¥è­˜ï¼ˆä»»æ„ï¼‰
- âœ… Pythonã®åŸºç¤æ–‡æ³•
- âœ… ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³æ“ä½œ

### Day 0: ç’°å¢ƒæº–å‚™ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### ğŸ¯ ç›®æ¨™
Flaskã‚¢ãƒ—ãƒªã®é››å½¢ã‚’ä½œæˆã—ã€Dockerã‚³ãƒ³ãƒ†ãƒŠä¸Šã§ã€ŒHello, Worldã€ã‚’è¡¨ç¤º

#### ğŸ“‹ ã‚¿ã‚¹ã‚¯
1. **Flaskãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ**
   ```bash
   mkdir stripe-gym
   cd stripe-gym
   python -m venv venv
   source venv/bin/activate  # Linux/Mac
   pip install flask python-dotenv
   ```

2. **Dockerãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**
   ```dockerfile
   FROM python:3.11-slim
   WORKDIR /app
   COPY requirements.txt .
   RUN pip install -r requirements.txt
   COPY . .
   EXPOSE 5000
   CMD ["python", "app.py"]
   ```

3. **åŸºæœ¬çš„ãªFlaskã‚¢ãƒ—ãƒª**
   ```python
   from flask import Flask
   app = Flask(__name__)
   
   @app.route('/')
   def hello():
       return "Hello, StripeGym!"
   
   if __name__ == '__main__':
       app.run(host='0.0.0.0', port=5000)
   ```

#### âœ… å®Œäº†æ¡ä»¶
- Dockerfileã§ã‚¢ãƒ—ãƒªãŒèµ·å‹•
- `http://localhost:5000` ã§ã€ŒHello, StripeGym!ã€è¡¨ç¤º

---

### Day 1: Stripe Checkoutã®å°å…¥

#### ğŸ¯ ç›®æ¨™
Stripe APIã‚­ãƒ¼è¨­å®šã¨Checkout Sessionä½œæˆ

#### ğŸ“‹ ã‚¿ã‚¹ã‚¯
1. **Stripeã‚¢ã‚«ã‚¦ãƒ³ãƒˆæº–å‚™**
   ```bash
   # Stripeãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§å–å¾—
   STRIPE_PUBLISHABLE_KEY=pk_test_xxxxx
   STRIPE_SECRET_KEY=sk_test_xxxxx
   ```

2. **ç’°å¢ƒå¤‰æ•°è¨­å®š**
   ```python
   # .envãƒ•ã‚¡ã‚¤ãƒ«
   STRIPE_SECRET_KEY=sk_test_your_key_here
   STRIPE_PUBLISHABLE_KEY=pk_test_your_key_here
   ```

3. **Checkout Sessionä½œæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**
   ```python
   import stripe
   from flask import jsonify, request
   
   @app.route('/api/create-checkout-session', methods=['POST'])
   def create_checkout_session():
       try:
           session = stripe.checkout.Session.create(
               payment_method_types=['card'],
               line_items=[{
                   'price_data': {
                       'currency': 'jpy',
                       'product_data': {'name': 'ãƒ†ã‚¹ãƒˆå•†å“'},
                       'unit_amount': 1000,
                   },
                   'quantity': 1,
               }],
               mode='payment',
               success_url='http://localhost:8080/success',
               cancel_url='http://localhost:8080/cancel'
           )
           return jsonify({'id': session.id})
       except Exception as e:
           return jsonify({'error': str(e)}), 400
   ```

#### âœ… å®Œäº†æ¡ä»¶
- Stripeãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆæ±ºæ¸ˆãƒšãƒ¼ã‚¸è¡¨ç¤º
- ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰ã§æ±ºæ¸ˆå®Œäº†

---

### Day 2: æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ã®ç¢ºèªã¨UIæ•´å‚™

#### ğŸ¯ ç›®æ¨™
æˆåŠŸ/ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒšãƒ¼ã‚¸å®Ÿè£…ã¨ãƒ†ã‚¹ãƒˆæ±ºæ¸ˆæ¤œè¨¼

#### ğŸ“‹ ã‚¿ã‚¹ã‚¯
1. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒšãƒ¼ã‚¸ä½œæˆ**
   ```html
   <!-- success.html -->
   <body>
       <h1>æ±ºæ¸ˆå®Œäº†ï¼</h1>
       <p>ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚æ±ºæ¸ˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚</p>
       <script>
           const urlParams = new URLSearchParams(window.location.search);
           const sessionId = urlParams.get('session_id');
           console.log('Session ID:', sessionId);
       </script>
   </body>
   ```

2. **Checkoutãƒœã‚¿ãƒ³å®Ÿè£…**
   ```javascript
   // checkout.js
   const stripe = Stripe('pk_test_your_key');
   
   async function checkout() {
       const response = await fetch('/api/create-checkout-session', {
           method: 'POST'
       });
       const session = await response.json();
       const result = await stripe.redirectToCheckout({sessionId: session.id});
   }
   ```

#### âœ… å®Œäº†æ¡ä»¶
- UIçµŒç”±ã§Checkout Sessioné–‹å§‹
- æ±ºæ¸ˆå®Œäº†å¾Œsuccessãƒšãƒ¼ã‚¸è¡¨ç¤º

---

### Day 3: Webhookå—ä¿¡ã®å®Ÿè£…

#### ğŸ¯ ç›®æ¨™
Flaskã§Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä½œæˆã€Stripeã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡

#### ğŸ“‹ ã‚¿ã‚¹ã‚¯
1. **Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä½œæˆ**
   ```python
   @app.route('/webhook', methods=['POST'])
   def webhook():
       payload = request.data
       sig_header = request.headers.get('Stripe-Signature')
       
       try:
           event = stripe.Webhook.construct_event(
               payload, sig_header, WH_SECRET
           )
       except ValueError:
           return jsonify({'error': 'Invalid payload'}), 400
       except stripe.error.SignatureVerificationError:
           return jsonify({'error': 'Invalid signature'}), 400
       
       # ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
       if event['type'] == 'checkout.session.completed':
           session = event['data']['object']
           print(f"Payment completed: {session['id']}")
       
       return jsonify({'status': 'success'}), 200
   ```

2. **Stripe CLIè¨­å®š**
   ```bash
   stripe listen --forward-to localhost:5000/webhook
   ```

#### âœ… å®Œäº†æ¡ä»¶
- Stripe CLIçµŒç”±ã§Webhookå—ä¿¡ç¢ºèª
- ãƒ­ã‚°ã«æ±ºæ¸ˆå®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤º

---

### Day 4: å°å¸³ï¼ˆLedgerï¼‰ã®å®Ÿè£…

#### ğŸ¯ ç›®æ¨™
Webhookå—ä¿¡æƒ…å ±ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è¨˜éŒ²

#### ğŸ“‹ ã‚¿ã‚¹ã‚¯
1. **SQLAlchemyãƒ¢ãƒ‡ãƒ«å®šç¾©**
   ```python
   from sqlalchemy import create_engine, Column, String, Integer
   from sqlalchemy.ext.declarative import declarative_base
   from sqlalchemy.orm import sessionmaker
   
   Base = declarative_base()
   
   class Ledger(Base):
       __tablename__ = 'ledger'
       id = Column(String, primary_key=True)
       customer_id = Column(String)
       amount = Column(Integer)
       currency = Column(String)
       description = Column(String)
   ```

2. **Webhookã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜**
   ```python
   def handle_checkout_completed(session):
       ledger = Ledger(
           id=session['id'],
           customer_id=session['customer'],
           amount=session['amount_total'],
           currency=session['currency'],
           description=f"Checkout: {session['id']}"
       )
       db_session.add(ledger)
       db_session.commit()
   ```

#### âœ… å®Œäº†æ¡ä»¶
- æ±ºæ¸ˆå¾Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è¨˜éŒ²ä¿å­˜
- Stripeãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¨çªåˆç¢ºèª

---

### Day 5: ç·åˆãƒ†ã‚¹ãƒˆã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

#### ğŸ¯ ç›®æ¨™
è¤‡æ•°æ±ºæ¸ˆã§å°å¸³ã¨Stripeè¨˜éŒ²ã®çªåˆã€ãƒ­ã‚°ç¢ºèª

#### ğŸ“‹ ã‚¿ã‚¹ã‚¯
1. **ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªå®Ÿè¡Œ**
   ```bash
   # è¤‡æ•°ã®æ±ºæ¸ˆãƒ†ã‚¹ãƒˆ
   curl -X POST http://localhost:5000/api/create-checkout-session
   # â†’ Stripeã§æ±ºæ¸ˆå®Œäº†
   # â†’ Webhookç¢ºèª
   # â†’ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèª
   ```

2. **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯**
   ```sql
   SELECT 
       l.id as ledger_id,
       l.amount,
       c.id as stripe_checkout_id,
       c.amount_total
   FROM ledger l
   JOIN stripe_checkouts c ON l.id = c.id;
   ```

#### âœ… å®Œäº†æ¡ä»¶
- è¤‡æ•°æ±ºæ¸ˆã®è¨˜éŒ²ç¢ºèª
- Stripeã¨ãƒ­ãƒ¼ã‚«ãƒ«DBã®æ•´åˆæ€§ç¢ºèª

---

### Day 6: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

#### ğŸ¯ ç›®æ¨™
READMEæ•´å‚™ã¨æ¬¡ã‚¹ãƒ†ãƒƒãƒ—æº–å‚™

#### ğŸ“‹ ã‚¿ã‚¹ã‚¯
1. **READMEä½œæˆ**
   ```markdown
   # StripeGym
   
   ã‚·ãƒ³ãƒ—ãƒ«ãªStripeæ±ºæ¸ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
   
   ## æ©Ÿèƒ½
   - Stripe Checkoutæ±ºæ¸ˆ
   - Webhookè‡ªå‹•åŒæœŸ
   - ãƒ¬ã‚¸ãƒ£ãƒ¼è¨˜éŒ²
   
   ## èµ·å‹•æ–¹æ³•
   ```bash
   docker-compose up -d
   ```
   ```

2. **æ¬¡ã‚¹ãƒ†ãƒƒãƒ—æº–å‚™**
   - Advancedç·¨ Day7-Day15ã®ç¢ºèª
   - æœ¬ç•ªç’°å¢ƒè¨­è¨ˆã®è¨ˆç”»

---

## ğŸš€ å¿œç”¨ç·¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰ (Day7-Day15)

> **æœ¬æ ¼é‹ç”¨ï¼ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«ã®æ©Ÿèƒ½ã‚’å®Ÿè£…**

å‰ææ¡ä»¶ï¼š
- âœ… åŸºæœ¬ç·¨ï¼ˆDay0-6ï¼‰å®Œäº†
- âœ… Docker/PostgreSQLã®åŸºæœ¬ç†è§£
- âœ… Stripe Checkoutå®Ÿè£…çµŒé¨“

### Day 7: å®šæœŸèª²é‡‘ï¼ˆSubscriptionï¼‰å¯¾å¿œ

#### ğŸ¯ ç›®æ¨™
Stripe Checkoutã§ã®å®šæœŸèª²é‡‘å°å…¥

#### ğŸ“‹ å®Ÿè£…å†…å®¹
- **Stripeã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä½œæˆ**
  ```python
  @app.route('/api/create-subscription-session', methods=['POST'])
  def create_subscription_session():
      session = stripe.checkout.Session.create(
          mode='subscription',
          line_items=[{
              'price': SUBSCRIPTION_PRICE_ID,
              'quantity': 1,
          }],
          success_url='http://localhost:8080/success-subscription',
          cancel_url='http://localhost:8080/cancel'
      )
      return jsonify({'id': session.id})
  ```

- **Subscriptionãƒ¢ãƒ‡ãƒ«è¿½åŠ **
  ```python
  class Subscription(Base):
      __tablename__ = 'subscriptions'
      id = Column(String, primary_key=True)
      user_id = Column(Integer)
      stripe_subscription_id = Column(String)
      plan_id = Column(String)
      status = Column(String)  # active, canceled, etc.
      current_period_end = Column(Integer)
  ```

#### âœ… å®Œæˆæ©Ÿèƒ½
- æœˆé¡ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ±ºæ¸ˆ
- ç¶™ç¶šèª²é‡‘ã®è‡ªå‹•å‡¦ç†
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç†

---

### Day 8: Webhookã®ä¿¡é ¼æ€§å‘ä¸Š

#### ğŸ¯ ç›®æ¨™
Webhookå†é€å¯¾å¿œã€å†ªç­‰æ€§ç¢ºä¿

#### ğŸ“‹ å®Ÿè£…å†…å®¹
- **å‡¦ç†æ¸ˆã¿ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†**
  ```python
  class ProcessedEvent(Base):
      __tablename__ = 'processed_events'
      id = Column(String, primary_key=True)  # Stripe event ID
      processed_at = Column(DateTime, default=datetime.utcnow)
      event_type = Column(String)
  
  def is_event_processed(event_id):
      return db_session.query(ProcessedEvent).filter_by(id=event_id).first() != None
  ```

- **å†ªç­‰æ€§ç¢ºä¿**
  ```python
  @app.route('/webhook', methods=['POST'])
  def webhook():
      event_id = event.get("id")
      
      # é‡è¤‡é˜²æ­¢ãƒã‚§ãƒƒã‚¯
      if is_event_processed(event_id):
          print(f"âš  Event already processed: {event_id}")
          return "", 200
      
      # ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
      # ...
      
      # å‡¦ç†æ¸ˆã¿ã¨ã—ã¦ãƒãƒ¼ã‚¯
      mark_event_processed(event_id, event_type)
  ```

#### âœ… å®Œæˆæ©Ÿèƒ½
- é‡è¤‡Webhookã‚¤ãƒ™ãƒ³ãƒˆé˜²æ­¢
- å‡¦ç†æ¸ˆã¿ã‚¤ãƒ™ãƒ³ãƒˆã®æ°¸ç¶šåŒ–
- ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®å¼·åŒ–

---

### Day 9: PostgreSQLç§»è¡Œ

#### ğŸ¯ ç›®æ¨™
SQLiteã‹ã‚‰PostgreSQLã¸ã®ç§»è¡Œ

#### ğŸ“‹ å®Ÿè£…å†…å®¹
- **PostgreSQLæ¥ç¶šè¨­å®š**
  ```python
  # config.py
  DATABASE_URL = os.getenv(
      'DATABASE_URL',
      'postgresql://username:password@localhost/stripe_gym'
  )
  
  engine = create_engine(DATABASE_URL)
  ```

- **Alembicãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**
  ```bash
  alembic revision --autogenerate -m "Add subscription table"
  alembic upgrade head
  ```

#### âœ… å®Œæˆæ©Ÿèƒ½
- PostgreSQLé‹ç”¨æº–å‚™
- æœ¬æ ¼çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é‹ç”¨

---

### Day 10: æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ

#### ğŸ¯ ç›®æ¨™
Gunicorn + Nginx + Docker Composeã§æœ¬ç•ªæ§‹æˆ

#### ğŸ“‹ å®Ÿè£…å†…å®¹
- **Gunicornè¨­å®š**
  ```python
  # wsgi.py
  from app import app
  
  if __name__ == "__main__":
      app.run()
  ```

- **Nginxè¨­å®š**
  ```nginx
  server {
      listen 80;
      location / {
          proxy_pass http://app:5000;
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
      }
  }
  ```

- **Docker Compose**
  ```yaml
  version: '3.8'
  services:
    app:
      build: ./backend
      command: gunicorn --bind 0.0.0.0:5000 wsgi:app
      depends_on:
        - db
    
    db:
      image: postgres:13
      environment:
        POSTGRES_DB: stripe_gym
        POSTGRES_USER: user
        POSTGRES_PASSWORD: password
  ```

#### âœ… å®Œæˆæ©Ÿèƒ½
- æœ¬ç•ªãƒ¬ãƒ™ãƒ«ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆ
- ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ

---

### Day 11: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰åˆ†é›¢

#### ğŸ¯ ç›®æ¨™
Stripe.jsã§UIã‚’åˆ†é›¢ã€ã‚ˆã‚Šè¡¨ç¾è±Šã‹ãªãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

#### ğŸ“‹ å®Ÿè£…å†…å®¹
- **Stripe.jsçµ±åˆ**
  ```javascript
  const stripe = Stripe('pk_test_your_key');
  
  async function createCheckoutSession() {
      const response = await fetch('/api/create-checkout-session', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
              price_id: 'price_1234567890',
              quantity: 1
          })
      });
      
      const session = await response.json();
      
      const result = await stripe.redirectToCheckout({
          sessionId: session.id
      });
  }
  ```

- **ãƒ¢ãƒ€ãƒ³ãªUIå®Ÿè£…**
  ```css
  .checkout-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 16px;
      padding: 12px 24px;
      cursor: pointer;
  }
  ```

#### âœ… å®Œæˆæ©Ÿèƒ½
- Stripe Elementsã«ã‚ˆã‚‹ç¾ã—ã„æ±ºæ¸ˆUI
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–

---

### Day 12: Customer Portalçµ±åˆ

#### ğŸ¯ ç›®æ¨™
Stripe Customer Portalã«ã‚ˆã‚‹é¡§å®¢ç®¡ç†

#### ğŸ“‹ å®Ÿè£…å†…å®¹
- **Customer Portal API**
  ```python
  @app.route('/api/billing-portal/start', methods=['POST'])
  @login_required
  def start_billing_portal():
      user_id = get_user_id_from_session()
      user = get_user_by_id(user_id)
      
      session = stripe.billing_portal.Session.create(
          customer=user.stripe_customer_id,
          return_url='http://localhost:8080/mypage.html'
      )
      return jsonify({'url': session.url})
  ```

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆ**
  ```javascript
  function startBillingPortal() {
      fetch('/api/billing-portal/start', {
          method: 'POST',
          headers: {'Authorization': `Bearer ${session_token}`}
      })
      .then(response => response.json())
      .then(data => {
          if (data.url) {
              window.location.href = data.url;
          }
      });
  }
  ```

#### âœ… å®Œæˆæ©Ÿèƒ½
- Stripe Customer Portalçµ±åˆ
- é¡§å®¢ã®è‡ªç«‹ã—ãŸæ”¯æ‰•ã„ç®¡ç†
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†UI

---

### Day 13-15: ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³æº–å‚™å®Œå…¨ç‰ˆ

#### ğŸ¯ ç›®æ¨™
ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã®çµ±åˆ

#### ğŸ“‹ Day 13: ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–
- **96%ã‚«ãƒãƒ¬ãƒƒã‚¸ã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ**
  ```bash
  ./backend/tests/run_tests.sh
  # 16ç¨®é¡ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
  # pytest + stripe-mockçµ±åˆ
  ```

- **CI/CDè‡ªå‹•åŒ–**
  ```yaml
  # .github/workflows/test.yml
  jobs:
    test:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v4
        - name: Run tests
          run: pytest tests/ --cov=app
  ```

#### ğŸ“‹ Day 14: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½**
  ```python
  # security.py
  def rate_limit(max_requests=60, window_size=60):
      # ãƒ¬ãƒ¼ãƒˆåˆ¶é™å®Ÿè£…
  
  def setup_security_headers(app):
      # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š
  
  def validate_user_input(data, rules):
      # å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  ```

#### ğŸ“‹ Day 15: ç›£è¦–ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- **ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ **
  ```python
  # monitoring.py  
  class NotificationService:
      def send_slack_notification(self, message, severity):
          # Slacké€šçŸ¥æ©Ÿèƒ½
  
      def monitor_performance(self, func_name):
          # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
    
  def health_check():
      # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
  ```

- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ **
  ```python
  # cache.py
  class CacheService:
      def cached(self, ttl=None):
          # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿
  
  class StripeGymCache:
      def cache_user_data(self, user_id, ttl=900):
          # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  ```

#### âœ… Day13-15å®Œæˆæ©Ÿèƒ½
- âœ… **96%ã‚«ãƒãƒ¬ãƒƒã‚¸**ã®ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–
- âœ… **GitHub Actions**ã«ã‚ˆã‚‹CI/CD
- âœ… **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºç´šã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**ï¼ˆãƒ¬ãƒ¼ãƒˆåˆ¶é™ã€IPåˆ¶é™ã€ãƒ˜ãƒƒãƒ€ãƒ¼ä¿è­·ï¼‰
- âœ… **ç›£è¦–ãƒ»ãƒ­ã‚°ãƒ»é€šçŸ¥**ã‚·ã‚¹ãƒ†ãƒ ï¼ˆSlackçµ±åˆï¼‰
- âœ… **Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥**ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- âœ… **æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ**æº–å‚™å®Œäº†

---

## ğŸŒ æœ¬ç•ªé‹ç”¨ã¨ç®¡ç†

> **ã“ã“ã‹ã‚‰å®Ÿæˆ¦ï¼æœ¬æ ¼çš„ãªã‚µãƒ¼ãƒ“ãƒ¼ã‚¹é‹ç”¨**

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€å®Œæˆã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®**æœ¬ç•ªç’°å¢ƒã§ã®é‹ç”¨æ–¹æ³•**ã‚’è§£èª¬ã—ã¾ã™ï¼š

### é–‹ç™ºç’°å¢ƒã§ã®èµ·å‹•

```bash
# 1. ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd stripe-gym

# 2. ç’°å¢ƒå¤‰æ•°è¨­å®š
cp env.production.example .env
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦APIã‚­ãƒ¼ã‚’è¨­å®š

# 3. Dockerèµ·å‹•
docker-compose up -d

# 4. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
docker-compose exec app alembic upgrade head

# 5. ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª
curl http://localhost:8080/health
```

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè¡Œ
./backend/tests/run_tests.sh

# å€‹åˆ¥ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker-compose exec app python -m pytest tests/test_integration.py -v

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆ
docker-compose exec app python -m pytest tests/ --cov=app --cov-report=html
```

### æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# 1. æœ¬ç•ªç’°å¢ƒè¨­å®š
cp env.production.example .env.production

# 2. ç’°å¢ƒå¤‰æ•°ã‚’æœ¬ç•ªå€¤ã«æ›´æ–°
# - STRIPE_SECRET_KEY (æœ¬ç•ªç”¨ãƒ©ã‚¤ãƒ–ã‚­ãƒ¼)
# - DATABASE_URL (æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)
# - SLACK_WEBHOOK_URL (é€šçŸ¥ç”¨)

# 3. æœ¬ç•ªèµ·å‹•
docker-compose -f docker-compose.production.yml up -d

# 4. SSLè¨¼æ˜æ›¸è¨­å®šï¼ˆLet's Encryptæ¨å¥¨ï¼‰
certbot --nginx -d your-domain.com
```

### CI/CDé‹ç”¨

```bash
# GitHub Actionsè‡ªå‹•å®Ÿè¡Œ
git push origin main
# â†’ è‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ â†’ stagingç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

# æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹
git tag v1.0.0
git push origin v1.0.0  
# â†’ productionç’°å¢ƒã¸ã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
```

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

> **äºˆæœŸã—ãªã„å•é¡Œã®è§£æ±ºæ³•**

é–‹ç™ºãƒ»é‹ç”¨ä¸­ã«ã‚ˆãé­é‡ã™ã‚‹å•é¡Œã¨ã€ãã®å¯¾å‡¦æ³•ã‚’ç¶²ç¾…çš„ã«è§£èª¬ã—ã¾ã™ï¼š

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–

#### 1. Stripe Webhookå—ä¿¡ã‚¨ãƒ©ãƒ¼

**å•é¡Œ**: WebhookãŒå—ä¿¡ã§ããªã„
```bash
âŒ Webhook signature verification failed
```

**è§£æ±ºç­–**:
```bash
# 1. Stripe CLIè¨­å®šç¢ºèª
stripe listen --forward-to localhost:5000/webhook

# 2. Webhook Secretç¢ºèª
# Stripe ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’ é–‹ç™ºè€… â†’ Webhooks â†’ ãƒ†ã‚¹ãƒˆç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
# â†’ ç½²åã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ã‚³ãƒ”ãƒ¼ â†’ .envãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®š

# 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª
docker-compose exec app python -c "from repositories import init_db; init_db()"
```

#### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼

**å•é¡Œ**: PostgreSQLæ¥ç¶šå¤±æ•—
```bash
âŒ cannot connect to database
```

**è§£æ±ºç­–**:
```bash
# 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ãƒŠç¢ºèª
docker-compose ps db

# 2. æ¥ç¶šæ–‡å­—åˆ—ç¢ºèª
docker-compose exec app env | grep DATABASE_URL

# 3. PostgreSQLå†èµ·å‹•
docker-compose restart db
```

#### 3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼

**å•é¡Œ**: pytestå®Ÿè¡Œå¤±æ•—
```bash
âŒ ModuleNotFoundError: redis
```

**è§£æ±ºç­–**:
```bash
# 1. ä¾å­˜é–¢ä¿‚å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
docker-compose exec app pip install -r requirements.txt

# 2. Dockerã‚¤ãƒ¡ãƒ¼ã‚¸å†ãƒ“ãƒ«ãƒ‰
docker-compose build --no-cache app

# 3. stripe-mockèµ·å‹•ç¢ºèª
./backend/tests/scripts/start-stripe-mock.sh
```

#### 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã‚¨ãƒ©ãƒ¼

**å•é¡Œ**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®šã‚¨ãƒ©ãƒ¼
```bash
âŒ Redisæ¥ç¶šå¤±æ•— ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã¯ç„¡åŠ¹
```

**è§£æ±ºç­–**:
```bash
# RedisãŒä¸è¦ãªå ´åˆã¯ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã¨ã—ã¦ç„¡åŠ¹åŒ–
# ã‚¨ãƒ©ãƒ¼ã¯å‡ºã‚‹ãŒæ©Ÿèƒ½ã¯å‹•ä½œã™ã‚‹ï¼ˆwarning ãƒ¬ãƒ™ãƒ«ï¼‰

# Redisã‚’ä½¿ã„ãŸã„å ´åˆã¯
docker-compose exec app pip install redis
docker-compose exec app redis-cli ping
```

### ãƒ­ã‚°ç¢ºèªæ–¹æ³•

```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°
docker-compose logs app

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ­ã‚°
docker-compose logs db

# Webhookãƒ†ã‚¹ãƒˆ
stripe trigger checkout.session.completed

# ãƒ˜ãƒ«ã‚¹ã®ãƒã‚§ãƒƒã‚¯
curl http://localhost:8080/health
curl http://localhost:8080/health/internal
```

---

## ğŸ“ˆ æ¬¡ã¸ã®ç™ºå±•ã¨ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

> **ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢å¾Œã®æ–°ã—ã„æŒ‘æˆ¦**

StripeGymå®Œå…¨æ”»ç•¥å¾Œã®ã•ã‚‰ãªã‚‹ç™ºå±•æ¡ˆã€‚æŠ€è¡“çš„ãªé€²åŒ–ã‹ã‚‰ãƒ“ã‚¸ãƒã‚¹å±•é–‹ã¾ã§ï¼š

### ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—ã®ææ¡ˆ

#### 1. ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹åŒ–
```bash
# ã‚µãƒ¼ãƒ“ã‚¹åˆ†å‰²æ¡ˆ
auth-service/          # èªè¨¼å°‚ç”¨
payment-service/       # æ±ºæ¸ˆå°‚ç”¨  
notification-service/  # é€šçŸ¥å°‚ç”¨
customer-service/      # é¡§å®¢ç®¡ç†å°‚ç”¨
```

#### 2. Kubernetesç§»è¡Œ
```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: stripe-gym-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: stripe-gym-app
  template:
    metadata:
      labels:
        app: stripe-gym-app
    spec:
      containers:
      - name: app
        image: stripe-gym:latest
        ports:
        - containerPort: 5000
```

#### 3. ç›£è¦–å¼·åŒ–
```python
# Prometheus + Grafanaå°å…¥
from prometheus_client import Counter, Histogram, generate_latest

# Metrics
PAYMENT_COUNTER = Counter('payments_total', 'Total payments')
RESPONSE_TIME = Histogram('response_time_seconds', 'Response time')

@app.route('/metrics')
def metrics():
    return generate_latest()
```

#### 4. APIä»•æ§˜åŒ–
```yaml
# OpenAPI/Swaggerä»•æ§˜æ›¸ä½œæˆ
openapi: 3.0.0
info:
  title: StripeGym API
  version: 1.0.0
paths:
  /api/create-checkout-session:
    post:
      summary: Create session
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                price_id:
                  type: string
```

### é–‹ç™ºãƒãƒ¼ãƒ å±•é–‹

#### 1. ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹
```bash
# PRãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
## å¤‰æ›´æ¦‚è¦
## ãƒ†ã‚¹ãƒˆæ¸ˆã¿é …ç›®
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆ
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

## ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚¤ãƒ³ãƒˆ
## æ±ºæ¸ˆãƒ†ã‚¹ãƒˆç¢ºèª
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆ
- [ ] Webhookç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç¢ºèª
```

#### 2. é–‹ç™ºç’°å¢ƒçµ±ä¸€
```bash
# pre-commit hooks
.pre-commit-config.yaml:
  - repo: https://github.com/psf/black
    rev: 22.3.0
    hooks:
      - id: black
        language_version: python3.11
  - repo: https://github.com/pycqa/flake8
    rev: 4.0.1
    hooks:
      - id: flake8
```

### ãƒ“ã‚¸ãƒã‚¹æ‹¡å¼µ

#### 1. ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œ
```python
# çµ„ç¹”ãƒ¬ãƒ™ãƒ«ã§ã®åˆ‡ã‚Šåˆ†ã‘
class Organization(Base):
    __tablename__ = 'organizations'
    id = Column(Integer, primary_key=True)
    name = Column(String)
    stripe_account_id = Column(String)  # Connect platform

class User(Base):
    organization_id = Column(Integer, ForeignKey('organizations.id'))
```

#### 2. å¤šé€šè²¨å¯¾å¿œ
```python
class Payment(Base):
    currency = Column(String(3))
    amount = Column(Integer)  # æœ€å°é€šè²¨å˜ä½
    exchange_rate = Column(Float)
    local_amount = Column(Integer)
```

#### 3. Webhookãƒãƒƒãƒå‡¦ç†
```python
# Celery + Redis for async processing
@celery.task
def process_webhook_batch(events):
    for event in events:
        process_single_event.delay(event)
```

---

## ğŸ‰ ã¾ã¨ã‚

StripeGymã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã‚’å®Œäº†ã™ã‚‹ã“ã¨ã§ã€ä»¥ä¸‹ã®ä¾¡å€¤ã‚’å®Ÿç¾ã§ãã¾ã™ï¼š

### ğŸ”¥ æŠ€è¡“çš„ä¾¡å€¤
- âœ… **æœ¬æ ¼çš„ãªæ±ºæ¸ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ã®è¨­è¨ˆãƒ»å®Ÿè£…
- âœ… **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºç´šã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**å®Ÿè£…
- âœ… **è‡ªå‹•åŒ–ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤**ç’°å¢ƒ
- âœ… **ç›£è¦–ãƒ»é‹ç”¨**ã«åŸºã¥ãä¿¡é ¼æ€§ã®é«˜ã„ã‚·ã‚¹ãƒ†ãƒ 

### ğŸ’¼ ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤  
- âœ… **ãƒãƒã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³**å¯èƒ½ãªæ±ºæ¸ˆã‚µãƒ¼ãƒ“ã‚¹åŸºç›¤
- âœ… **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«**ãªãƒ¦ãƒ¼ã‚¶ãƒ¼æˆé•·å¯¾å¿œ
- âœ… **é‹ç”¨ã‚³ã‚¹ãƒˆå‰Šæ¸›**ã®è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ 
- âœ… **é¡§å®¢ä½“é¨“å‘ä¸Š**ã®ãŸã‚ã® Portal çµ±åˆ

### ğŸš€ å­¦ç¿’ä¾¡å€¤
- âœ… **ç¾ä»£çš„ãªé–‹ç™ºæ‰‹æ³•**ã®å®Ÿè·µçš„ç¿’å¾—
- âœ… **ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å“è³ª**ã®ã‚³ãƒ¼ãƒ‰è¨­è¨ˆ
- âœ… **ãƒãƒ¼ãƒ é–‹ç™º**ã‚’æ„è­˜ã—ãŸãƒ„ãƒ¼ãƒ«è¨­å®š
- âœ… **ç¶™ç¶šçš„æ”¹å–„**ã®ãŸã‚ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ´»ç”¨

---

**ğŸŠ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼StripeGymã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ å®Œå…¨æ”»ç•¥é”æˆï¼ğŸŠ**

ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯**æœ¬ç‰©ã®ãƒ“ã‚¸ãƒã‚¹**ã¨ã—ã¦å±•é–‹å¯èƒ½ãªãƒ¬ãƒ™ãƒ«ã«åˆ°é”ã—ã¦ã„ã¾ã™ã€‚å­¦ç¿’ã‹ã‚‰å®Ÿè·µã€ãã—ã¦æœ¬æ ¼çš„ãªã‚µãƒ¼ãƒ“ã‚¹é‹å–¶ã¾ã§ã€ã™ã¹ã¦ã‚’ã‚«ãƒãƒ¼ã—ãŸåŒ…æ‹¬çš„ãªæ±ºæ¸ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œæˆã—ã¾ã—ãŸï¼

**ã“ã‚Œã‹ã‚‰ã®æŒ‘æˆ¦**
- ğŸŒŸ å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã®æœ¬ç•ªé‹ç”¨
- ğŸŒŸ æ–°ã—ã„æ±ºæ¸ˆæ©Ÿèƒ½ã®è¿½åŠ   
- ğŸŒŸ AIã‚’æ´»ç”¨ã—ãŸä¸æ­£æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
- ğŸŒŸ ã‚°ãƒ­ãƒ¼ãƒãƒ«å±•é–‹ã¸ã®å¤šé€šè²¨å¯¾å¿œ

StripeGymã‚’å’æ¥­å¾Œã‚‚ã€ã“ã®åŸºç›¤ã‚’æ´»ç”¨ã—ã¦ã•ã‚‰ãªã‚‹ç™ºå±•ã‚’ç¶šã‘ã¦ãã ã•ã„ï¼ğŸ’ªâœ¨
